# gcal-conference-editor

Google カレンダーのイベントの会議データ URI を編集するための Google Apps Script (GAS) ツールです。これにより、標準の Google カレンダーインターフェースでは編集できないビデオ会議リンク (Zoom, Teams など) を変更するのに役立ちます。

## 主な機能

- カレンダーとイベントを選択するためのシンプルな Web インターフェースを提供します。
- Google Calendar API を使用して、カレンダーとイベントを動的に取得します。
- イベントの会議データを新しい URI で更新します。

## デプロイ (自動化)

このプロジェクトは、GitHub Actions を使用してデプロイが自動化されています。

### 環境

- **本番環境**: `main` ブランチにマージされると、自動的に本番環境にデプロイされます。
- **プレビュー環境**: プルリクエストを作成または更新すると、そのブランチのプレビュー環境が自動的にデプロイされます。デプロイが完了すると、プルリクエストにプレビュー用の URL がコメントされます。

### 初回セットアップ

自動デプロイを機能させるには、いくつかのシークレットを GitHub リポジトリに設定する必要があります。

1.  **リポジトリをフォークまたはクローンします。**

2.  **Google Apps Script プロジェクトの準備:**
    このワークフローでは、本番環境とプレビュー環境用に 2 つの独立した Apps Script プロジェクトを使用します。
    - [script.google.com](https://script.google.com/home/projects/create) で 2 つの空のプロジェクトを作成します。
    - それぞれのプロジェクト設定（⚙️アイコン）から **スクリプト ID** をメモしておきます。

3.  **本番環境のデプロイを作成:**
    - 本番用の Apps Script プロジェクトで、手動で **ウェブアプリ** として一度デプロイします。
    - 作成された **デプロイ ID** をメモしておきます。

4.  **`clasp`でのログイン:**
    ローカルマシンで `clasp` をインストールし、Google アカウントにログインします。
    ```bash
    npm install -g @google/clasp
    clasp login
    ```
    このコマンドにより、ホームディレクトリに `.clasprc.json` という認証ファイルが作成されます。

5.  **GitHub Secretsの設定:**
    リポジトリの `Settings > Secrets and variables > Actions` に、以下の 4 つのシークレットを登録します。
    - `CLASPRC_JSON`: 上記手順で作成した `.clasprc.json` ファイルの中身全体をコピーして貼り付けます。
    - `PRODUCTION_SCRIPT_ID`: 本番環境用のスクリプト ID。
    - `PREVIEW_SCRIPT_ID`: プレビュー環境用のスクリプト ID。
    - `PRODUCTION_DEPLOYMENT_ID`: 本番環境用に作成したデプロイ ID。

上記の設定が完了すると、GitHub Actions による自動デプロイが有効になります。

## 手動でのデプロイ

CI/CD を使わずに、ローカル環境から手動でデプロイすることも可能です。

### 1. ローカルでのセットアップ

自動デプロイのセットアップ手順と同様に、`npm install` と `npx clasp login` を完了させておく必要があります。

また、手動でデプロイしたい Apps Script プロジェクトの ID を使って、リポジトリのルートに `.clasp.json` ファイルを作成する必要があります。

**.clasp.json の例:**
```json
{
  "scriptId": "ここにあなたのスクリプト ID を記入",
  "rootDir": "dist"
}
```

### 2. ビルドとプッシュ

ローカルでの変更を Apps Script プロジェクトに反映させるには、まずビルドを実行し、次に `push` コマンドを使用します。

```bash
# TypeScript をビルドし、必要なファイルを dist/ ディレクトリにコピーします
npm run build

# dist/ ディレクトリの内容を Google Apps Script プロジェクトにプッシュします
npx clasp push --force
```
`--force` オプションは、`appsscript.json` の変更を警告なしに上書きするために推奨されます。

### 3. デプロイ

コードをプッシュした後、`deploy` コマンドで新しいバージョンを作成・デプロイできます。

```bash
# 新しいデプロイを作成する場合
npx clasp deploy --description "手動でのデプロイ"

# 既存のデプロイを更新する場合 (デプロイ ID が必要です)
npx clasp deploy --deploymentId "ここにデプロイ ID を記入" --description "手動での更新"
```

デプロイが完了すると、Web アプリの URL（または新しいデプロイ ID）が出力されます。

## 使用方法

1.  デプロイされた **Web アプリの URL** を開きます。（本番 URL、または PR にコメントされたプレビュー URL）
2.  **カレンダーを選択:** アプリケーションは、最初のドロップダウンメニューに Google カレンダーのリストを読み込みます。変更したいイベントが含まれるカレンダーを選択します。
3.  **イベントを選択:** カレンダーを選択すると、2 番目のドロップダウンにそのカレンダーの今後のイベントのリストが表示されます。目的のイベントを選択します。
4.  **新しい URI を入力:** 「新しい会議の URI」フィールドに、ビデオ会議の新しいリンクを入力します。
5.  **「会議情報を更新」をクリックします**。
6.  更新が成功したかどうかを示すステータスメッセージが表示されます。