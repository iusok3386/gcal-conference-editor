# gcal-conference-editor

Googleカレンダーのイベントの会議データURIを編集するためのGoogle Apps Script (GAS) ツールです。これにより、標準のGoogleカレンダーインターフェースでは編集できないビデオ会議リンク（Zoom、Teamsなど）を変更するのに役立ちます。

## 主な機能

- カレンダーとイベントを選択するためのシンプルなWebインターフェースを提供します。
- Google Calendar APIを使用して、カレンダーとイベントを動的に取得します。
- イベントの会議データを新しいURIで更新します。

## デプロイ (自動化)

このプロジェクトは、GitHub Actionsを使用してデプロイが自動化されています。

### 環境

- **本番環境**: `main`ブランチにマージされると、自動的に本番環境にデプロイされます。
- **プレビュー環境**: プルリクエストを作成または更新すると、そのブランチのプレビュー環境が自動的にデプロイされます。デプロイが完了すると、プルリクエストにプレビュー用のURLがコメントされます。

### 初回セットアップ

自動デプロイを機能させるには、いくつかのシークレットをGitHubリポジトリに設定する必要があります。

1.  **リポジトリをフォークまたはクローンします。**

2.  **Google Apps Scriptプロジェクトの準備:**
    このワークフローでは、本番環境とプレビュー環境用に2つの独立したApps Scriptプロジェクトを使用します。
    - [script.google.com](https://script.google.com/home/projects/create)で2つの空のプロジェクトを作成します。
    - それぞれのプロジェクト設定（⚙️アイコン）から**スクリプトID**をメモしておきます。

3.  **本番環境のデプロイを作成:**
    - 本番用のApps Scriptプロジェクトで、手動で**ウェブアプリ**として一度デプロイします。
    - 作成された**デプロイID**をメモしておきます。

4.  **`clasp`でのログイン:**
    ローカルマシンで`clasp`をインストールし、Googleアカウントにログインします。
    ```bash
    npm install -g @google/clasp
    clasp login
    ```
    このコマンドにより、ホームディレクトリに`.clasprc.json`という認証ファイルが作成されます。

5.  **GitHub Secretsの設定:**
    リポジトリの `Settings > Secrets and variables > Actions` に、以下の4つのシークレットを登録します。
    - `CLASPRC_JSON`: 上記手順で作成した`.clasprc.json`ファイルの中身全体をコピーして貼り付けます。
    - `PRODUCTION_SCRIPT_ID`: 本番環境用のスクリプトID。
    - `PREVIEW_SCRIPT_ID`: プレビュー環境用のスクリプトID。
    - `PRODUCTION_DEPLOYMENT_ID`: 本番環境用に作成したデプロイID。

上記の設定が完了すると、GitHub Actionsによる自動デプロイが有効になります。

## 手動でのデプロイ

CI/CDを使わずに、ローカル環境から手動でデプロイすることも可能です。

### 1. ローカルでのセットアップ

自動デプロイのセットアップ手順と同様に、`npm install` と `npx clasp login` を完了させておく必要があります。

また、手動でデプロイしたいApps ScriptプロジェクトのIDを使って、リポジトリのルートに`.clasp.json`ファイルを作成する必要があります。

**.clasp.json の例:**
```json
{
  "scriptId": "ここにあなたのスクリプトIDを記入",
  "rootDir": "dist"
}
```

### 2. ビルドとプッシュ

ローカルでの変更をApps Scriptプロジェクトに反映させるには、まずビルドを実行し、次に`push`コマンドを使用します。

```bash
# TypeScriptをビルドし、必要なファイルをdist/ディレクトリにコピーします
npm run build

# dist/ディレクトリの内容をGoogle Apps Scriptプロジェクトにプッシュします
npx clasp push --force
```
`--force`オプションは、`appsscript.json`の変更を警告なしに上書きするために推奨されます。

### 3. デプロイ

コードをプッシュした後、`deploy`コマンドで新しいバージョンを作成・デプロイできます。

```bash
# 新しいデプロイを作成する場合
npx clasp deploy --description "手動でのデプロイ"

# 既存のデプロイを更新する場合 (デプロイIDが必要です)
npx clasp deploy --deploymentId "ここにデプロイIDを記入" --description "手動での更新"
```

デプロイが完了すると、WebアプリのURL（または新しいデプロイID）が出力されます。

## 使用方法

1.  デプロイされた**WebアプリのURL**を開きます。（本番URL、またはPRにコメントされたプレビューURL）
2.  **カレンダーを選択:** アプリケーションは、最初のドロップダウンメニューにGoogleカレンダーのリストを読み込みます。変更したいイベントが含まれるカレンダーを選択します。
3.  **イベントを選択:** カレンダーを選択すると、2番目のドロップダウンにそのカレンダーの今後のイベントのリストが表示されます。目的のイベントを選択します。
4.  **新しいURIを入力:** 「新しい会議のURI」フィールドに、ビデオ会議の新しいリンクを入力します。
5.  **「会議情報を更新」をクリックします**。
6.  更新が成功したかどうかを示すステータスメッセージが表示されます。