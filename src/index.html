<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      form { display: flex; flex-direction: column; gap: 10px; max-width: 500px; }
      label { font-weight: bold; }
      input[type="text"], input[type="url"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
      button { padding: 10px 15px; background-color: #4285F4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
      button:disabled { background-color: #aaa; cursor: not-allowed; }
      #status { margin-top: 15px; padding: 10px; border-radius: 4px; display: none; }
      .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
      .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
  </head>
  <body>
    <h1>Google Calendar Conference Editor</h1>
    <p>このツールは、Googleカレンダーのイベントに含まれるビデオ会議のURIを更新します。</p>

    <form id="update-form">
      <label for="calendarId">Calendar ID:</label>
      <input type="text" id="calendarId" name="calendarId" value="primary" required>

      <label for="eventId">Event ID:</label>
      <input type="text" id="eventId" name="eventId" required>

      <label for="newUri">New Conference URI:</label>
      <input type="url" id="newUri" name="newUri" required>

      <button type="submit" id="submit-button">Update Conference Info</button>
    </form>

    <div id="status"></div>

    <script>
      document.getElementById('update-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const form = event.target;
        const button = document.getElementById('submit-button');
        const statusDiv = document.getElementById('status');

        // Disable button and show loading status
        button.disabled = true;
        statusDiv.style.display = 'block';
        statusDiv.className = '';
        statusDiv.textContent = '更新中...';

        const calendarId = form.elements.calendarId.value;
        const eventId = form.elements.eventId.value;
        const newUri = form.elements.newUri.value;

        google.script.run
          .withSuccessHandler(function(response) {
            button.disabled = false;
            statusDiv.textContent = response.message;
            if (response.success) {
              statusDiv.className = 'success';
            } else {
              statusDiv.className = 'error';
            }
          })
          .withFailureHandler(function(error) {
            button.disabled = false;
            statusDiv.textContent = 'スクリプトの実行に失敗しました: ' + error.message;
            statusDiv.className = 'error';
          })
          .updateConferenceData(calendarId, eventId, newUri);
      });
    </script>
  </body>
</html>
